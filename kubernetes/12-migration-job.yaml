apiVersion: v1
kind: ConfigMap
metadata: 
  name: ts-config
  namespace: easyshop-hack
data:
  tsconfig.json: |
    {
      "compilerOptions": {
        "target": "es2016",
        "module": "commonjs",
        "esModuleInterop": true,
        "forceConsistentCasingInFileNames": true,
        "strict": true,
        "skipLibCheck": true,
        "outDir": "./dist"
        }
    }
---
apiVersion: batch/v1
kind: Job
metadata:
  name: db-migration-job-v2
  namespace: easyshop-hack
spec:
  backoffLimit: 2
  template: 
    spec:
      restartPolicy: Never
      volumes:
      - name: ts-config-volume
        configMap:
          name: ts-config
      containers:
      - name: migration 
        image: shaheen8954/easyshop-backend:latest
        envFrom:
        - configMapRef:
            name: mongodb-config
        - secretRef:
            name: easyshop-secrets
        env:
        - name: MONGODB_URI
          value: "mongodb://mongodb-service:27017/easyshop"
        - name: NODE_ENV
          value: "development"
        volumeMounts:
        - name: ts-config-volume
          mountPath: /app/scripts/tsconfig.json
          subPath: tsconfig.json